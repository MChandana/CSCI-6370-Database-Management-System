CREATE DATABASE CSCI6370db
  WITH OWNER = postgres;

-- Schema: DBMS_FINAL_PROJV1

-- DROP SCHEMA DBMS_FINAL_PROJV1;
  
CREATE SCHEMA DBMS_FINAL_PROJV1
  AUTHORIZATION root;

GRANT ALL ON SCHEMA DBMS_FINAL_PROJV1 TO root;
GRANT USAGE ON SCHEMA DBMS_FINAL_PROJV1 TO public;

DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS STUDENT;
DROP TABLE IF EXISTS FACULTY;
DROP TABLE IF EXISTS RESOURCE_MANAGER;
DROP TABLE IF EXISTS DEPARTMENT;
DROP TABLE IF EXISTS SERVICES;
DROP TABLE IF EXISTS RESOURCES;
DROP TABLE IF EXISTS SERVICE_ALLOCATION;

-- ****************************   DEPARTMENT  **********************************************************
CREATE TABLE DBMS_FINAL_PROJV1.DEPARTMENT (
	DEPT_ID INT PRIMARY KEY,
	DEPT_NAME VARCHAR(100) NOT NULL,
	DEPT_HEAD VARCHAR(50) NOT NULL,
	DEPT_LOCATION VARCHAR(100) NOT NULL
	);
	
-- Insert scripts

INSERT INTO DBMS_FINAL_PROJV1.DEPARTMENT(DEPT_ID,DEPT_NAME,DEPT_HEAD,DEPT_LOCATION) VALUES (1,'COMPUTER SCIENCE','THIAB TAHA','BOYD ATHENS');

INSERT INTO DBMS_FINAL_PROJV1.DEPARTMENT(DEPT_ID,DEPT_NAME,DEPT_HEAD,DEPT_LOCATION) VALUES (2,'BIOLOGICAL SCIENCES','JAMES SCOTT','UGA ATHENS');

INSERT INTO DBMS_FINAL_PROJV1.DEPARTMENT(DEPT_ID,DEPT_NAME,DEPT_HEAD,DEPT_LOCATION) VALUES (3,'PHYSICS','WHITNEY STONE','PHYSIXS UGA ATHENS');

-- *******************************    USERS   *******************************************************


CREATE TABLE DBMS_FINAL_PROJV1.USERS (
	xx81_ID INT PRIMARY KEY,
	MY_ID VARCHAR(20) UNIQUE NOT NULL,
	PASSWORD VARCHAR(50) NOT NULL,			
	NAME VARCHAR(100) NOT NULL,
	ADDRESS VARCHAR(255) NOT NULL,
	DEPT_ID INT NOT NULL,
	GENDER CHAR NOT NULL CHECK (GENDER IN ('M','F','O')),
	EMAIL_ID VARCHAR(50) NOT NULL,
	DATE_OF_BIRTH DATE NOT NULL CHECK (DATE_OF_BIRTH < now()),
	ROLE CHAR NOT NULL CHECK (ROLE IN ('F','S','R','D')),
	FOREIGN KEY (DEPT_ID) REFERENCES DBMS_FINAL_PROJV1.DEPARTMENT(DEPT_ID)
	);
CREATE EXTENSION pgcrypto;

-- Insert scripts
INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (811509557,'CX00527',crypt('PASSWORD1', gen_salt('md5')),'ABIGAIL','ATHENS GA',1,'F','CX00527@UGA.EDU',To_date('1992-05-30','YYYY-MM-DD'),'S');

INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (811519557,'CX12527',crypt('PASSWORD5', gen_salt('md5')),'MEENA','ATHENS GA',2,'F','CX12527@UGA.EDU',To_date('1990-01-31','YYYY-MM-DD'),'S');

INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (810509557,'CX20527',crypt('PASSWORD2', gen_salt('md5')),'SCOTT','ATHENS GA',2,'M','CX20527@UGA.EDU',To_date('1982-02-28','YYYY-MM-DD'),'F');

INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (810609557,'CX20528',crypt('PASSWORD2', gen_salt('md5')),'ADRIAN','ATHENS GA',3,'M','CX20528@UGA.EDU',To_date('1985-03-30','YYYY-MM-DD'),'F');

INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (811507547,'AX00527',crypt('PASSWORD3', gen_salt('md5')),'TATE','ATHENS GA',1,'M','AX00527@UGA.EDU',To_date('1972-06-06','YYYY-MM-DD'),'R');

INSERT INTO DBMS_FINAL_PROJV1.USERS(XX81_ID,MY_ID,PASSWORD,NAME,ADDRESS,DEPT_ID,GENDER,EMAIL_ID,DATE_OF_BIRTH,ROLE) 
VALUES (811529358,'BM00527',crypt('PASSWORD4', gen_salt('md5')),'BRITTANY','ATHENS GA',3,'F','BM00527@UGA.EDU',To_date('1966-01-24','YYYY-MM-DD'),'D');


-- *************************************   STUDENT   *************************************************

CREATE TABLE DBMS_FINAL_PROJV1.STUDENT (
	STUDENT_ID INT PRIMARY KEY,
	COURSE_TYPE VARCHAR(50) NOT NULL,
	SEMESTER_OF_JOINING VARCHAR(10),
	MAJOR_PROF_ID INT,
	FOREIGN KEY (STUDENT_ID) REFERENCES DBMS_FINAL_PROJV1.USERS(XX81_ID) ON DELETE CASCADE,
	FOREIGN KEY (MAJOR_PROF_ID) REFERENCES DBMS_FINAL_PROJV1.FACULTY(FACULTY_ID) ON UPDATE CASCADE
	);
	
-- Insert scripts

INSERT INTO DBMS_FINAL_PROJV1.STUDENT(STUDENT_ID,COURSE_TYPE,SEMESTER_OF_JOINING,MAJOR_PROF_ID) VALUES (811509557,'GRADUATE','FALL2015',810509557);

INSERT INTO DBMS_FINAL_PROJV1.STUDENT(STUDENT_ID,COURSE_TYPE,SEMESTER_OF_JOINING,MAJOR_PROF_ID) VALUES (811519557,'UNDERGRADUATE','FALL2016',810609557);


-- *****************************   FACULTY   *********************************************************
CREATE TABLE DBMS_FINAL_PROJV1.FACULTY (
	FACULTY_ID INT PRIMARY KEY,
	SPECIALIZATION VARCHAR(100),
	FOREIGN KEY (FACULTY_ID) REFERENCES DBMS_FINAL_PROJV1.USERS(XX81_ID) ON DELETE CASCADE
	);

-- Insert scripts
INSERT INTO DBMS_FINAL_PROJV1.FACULTY(FACULTY_ID,SPECIALIZATION) VALUES (810509557,'ROBOTICS');

INSERT INTO DBMS_FINAL_PROJV1.FACULTY(FACULTY_ID,SPECIALIZATION) VALUES (810609557,'BIOINFORMATICS');

-- *****************************  RESOURCE MANAGER  *********************************************************
CREATE TABLE DBMS_FINAL_PROJV1.RESOURCE_MANAGER (
	RSR_MANAGER_ID INT PRIMARY KEY,
	EXPERTISE VARCHAR(100),
	FOREIGN KEY (RSR_MANAGER_ID) REFERENCES DBMS_FINAL_PROJV1.USERS(XX81_ID) ON DELETE CASCADE
	);

-- Insert scripts
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_MANAGER(RSR_MANAGER_ID) VALUES (811507547);

-- *******************************  SERVICES  *******************************************************
CREATE TABLE DBMS_FINAL_PROJV1.SERVICES (
	SERVICE_ID INT PRIMARY KEY,
	SERVICE_NAME VARCHAR(50) UNIQUE NOT NULL,
	SERVICE_DESC VARCHAR(500) NOT NULL
	);

-- Insert scripts

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(1,'Machine Learning','MACHINE LEARNING SERVICE with complete ML packages and environment for executing normal machine learning models.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(2,'Deep Learning','Deep learning service comes with complete package of deep learning frameworks and computing environment.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(3,'Game Development','Game development service comes with game development suite and softwares pre-installed.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(4,'Dynamic web host','Web services for hosting dynamic web applications.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(5,'Code versioning','Code versioning system like GIT.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(6,'Desktop sharing','Remote access service.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(7,'Computing machine','Basic computing machine with naive configurations.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(8,'RDS Database engine','Relation database machine with basic storage capacity.');

INSERT INTO DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID,SERVICE_NAME,SERVICE_DESC) VALUES(9,'NoSql database engine','No sql databases with basic storage capacity.');

-- *******************************  RESOURCE_SERVICES_MAP  *******************************************************
CREATE TABLE DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP (
	RESOURCE_NAME VARCHAR(100),
	SERVICE_ID INT,
	CONSTRAINT pk_map PRIMARY KEY(RESOURCE_NAME,SERVICE_ID)
	);
	
-- Insert scripts
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Computer',1);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('GPU',1);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('RAM',1);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Computer',2);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('GPU',2);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('RAM',2);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Computer',3);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('GPU',3);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('RAM',3);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('File server',4);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Web server',4);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Network bandwidth',4);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Messaging server',4);


INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Cloud storage',5);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Tunnel Server',6);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Computer',7);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('File server',7);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('RAM',7);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('MySql machine',8);
INSERT INTO DBMS_FINAL_PROJV1.RESOURCE_SERVICES_MAP(RESOURCE_NAME,SERVICE_ID) VALUES('Mango db machine',9);

-- **********************************   RESOURCES   ****************************************************

CREATE TABLE DBMS_FINAL_PROJV1.RESOURCES (
	ASSET_ID INT PRIMARY KEY,
	RESOURCE_NAME VARCHAR(50) NOT NULL,
	SPECIFICATIONS VARCHAR(150) NOT NULL,
	NO_OF_COPIES INT DEFAULT 1,
	MANAGER_ID INT NOT NULL,
	SERVICE_ID INT DEFAULT NULL,
	FOREIGN KEY (MANAGER_ID) REFERENCES DBMS_FINAL_PROJV1.RESOURCE_MANAGER(RSR_MANAGER_ID) ON UPDATE CASCADE,
	FOREIGN KEY (SERVICE_ID) REFERENCES DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID) ON DELETE CASCADE
	);
	
-- Insert scripts
INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(1,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(2,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(3,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(4,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(5,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(6,'Computer','Intel i3 processor 2.4GHz.',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(7,'GPU','4GB 4cores',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(8,'GPU','4GB 4cores',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(9,'GPU','4GB 4cores',1,811507547,NULL);


INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(10,'GPU','4GB 4cores',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(11,'GPU','4GB 4cores',1,811507547,NULL);


INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(12,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(13,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(14,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(15,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(16,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(17,'RAM','4GB',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(18,'File server','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(19,'Web server','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(20,'File server','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(21,'Network bandwidth','2GBps',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(22,'Messaging server','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(23,'Cloud storage','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(24,'Tunnel Server','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(25,'MySql machine','2GB space',1,811507547,NULL);

INSERT INTO DBMS_FINAL_PROJV1.RESOURCES(ASSET_ID,RESOURCE_NAME,SPECIFICATIONS,NO_OF_COPIES,MANAGER_ID,SERVICE_ID) 
VALUES(26,'Mango db machine','2GB space',1,811507547,NULL);


-- ******************************    SERVICE ALLOCATION   ********************************************************

CREATE TABLE DBMS_FINAL_PROJV1.SERVICE_ALLOCATION (	
	REQUEST_ID INT PRIMARY KEY,
	STATUS VARCHAR(25) NOT NULL,
	FROM_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	TO_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	SERVICE_ID INT NOT NULL,
	USER_ID INT NOT NULL,
	DEPT_ID INT NOT NULL,
	CONSTRAINT SERV_FK1 FOREIGN KEY (SERVICE_ID) REFERENCES DBMS_FINAL_PROJV1.SERVICES(SERVICE_ID),
	CONSTRAINT SERV_FK2 FOREIGN KEY (USER_ID) REFERENCES DBMS_FINAL_PROJV1.USERS(XX81_ID),
	CONSTRAINT SERV_FK3 FOREIGN KEY (DEPT_ID) REFERENCES DBMS_FINAL_PROJV1.DEPARTMENT(DEPT_ID) 
	);
	


